{% comment %}
  Globaler Hinweis für institutionelle Kunden.
  Speichert den Status in localStorage (kein Cookie-Banner nötig).
{% endcomment %}

<div id="global-offer-toast" class="global-offer-toast" aria-hidden="true">
  <div class="got-content">
    <!-- SVG Icon (Briefumschlag) -->
    <div class="got-icon">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
        <polyline points="22,6 12,13 2,6"></polyline>
      </svg>
    </div>

    <!-- Text und Link -->
    <div class="got-text">
      <span class="got-title">Institutionelle Kunden (z.B. Kindergärten)</span>
      <a href="https://meinkreativstein.de/pages/contact" class="got-link">
        bitte Angebot anfordern
      </a>
    </div>

    <!-- Schließen Button -->
    <button type="button" class="got-close" aria-label="Hinweis schließen">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
  </div>
</div>

<style>
  /* --- Styling des Toasts --- */
  .global-offer-toast {
    position: fixed;
    /* Positionierung angepasst: Links & 3/4 Höhe */
    left: 20px;
    top: 25%; 
    z-index: 9999;
    max-width: 400px;
    width: calc(100% - 40px);
    
    background-color: #3ba53b; /* Das FAQ Grün */
    color: #ffffff;
    
    border-radius: 12px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    
    /* Startzustand für Animation (Dopsen von oben) */
    opacity: 0;
    transform: translateY(-100px); /* Startet 100px weiter oben */
    visibility: hidden;
    
    /* Die Fall-Animation (Federeffekt via cubic-bezier) */
    transition: all 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  }

  /* Klasse zum Anzeigen (Fällt an seinen Platz) */
  .global-offer-toast.is-visible {
    opacity: 1;
    transform: translateY(0); /* Landet auf der Endposition */
    visibility: visible;
  }

  /* Aufmerksamkeit: Wackelt nur der Inhalt, nur 1 Mal */
  .global-offer-toast.animate-attention .got-content {
    animation: gentle-shake 0.6s ease 1; /* Die '1' am Ende bedeutet: Nur 1x abspielen */
  }

  .got-content {
    display: flex;
    align-items: center;
    padding: 16px;
    gap: 12px;
    /* Transform Origin für das Wackeln */
    transform-origin: center;
  }

  /* Icon Style */
  .got-icon {
    flex-shrink: 0;
    width: 32px;
    height: 32px;
    background: rgba(255,255,255,0.2);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .got-icon svg {
    width: 18px;
    height: 18px;
    color: #fff;
  }

  /* Text Style */
  .got-text {
    flex-grow: 1;
    font-size: 0.95rem;
    line-height: 1.3;
  }

  .got-title {
    display: block;
    font-weight: 600;
    margin-bottom: 2px;
  }

  .got-link {
    color: #fff;
    text-decoration: underline;
    text-underline-offset: 2px;
    font-weight: 400;
  }
  .got-link:hover {
    color: rgba(255,255,255,0.9);
  }

  /* Schließen Button */
  .got-close {
    background: none;
    border: none;
    color: rgba(255,255,255,0.7);
    cursor: pointer;
    padding: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: color 0.2s;
    margin-left: 4px;
  }
  .got-close:hover {
    color: #fff;
  }

  /* Keyframe für das einmalige Wackeln */
  @keyframes gentle-shake {
    0%, 100% { transform: rotate(0deg); }
    25% { transform: rotate(-3deg); }
    50% { transform: rotate(3deg); }
    75% { transform: rotate(-1deg); }
  }

  /* Mobile Optimierung */
  @media (max-width: 480px) {
    .global-offer-toast {
      left: 10px;
      right: 10px; /* Auf Mobile nehmen wir volle Breite (minus Margin) */
      top: auto;   /* Reset top für Mobile, falls es sonst Tastatur verdeckt */
      bottom: 20px; /* Am Boden andocken ist auf Mobile meist sicherer */
      width: auto;
      
      /* Auf Mobile vielleicht lieber von unten reinkommen? 
         Wenn du "von oben" auch auf Mobile willst, lösche 'top: auto' und 'bottom: 20px' */
    }
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    const toast = document.getElementById('global-offer-toast');
    const closeBtn = toast.querySelector('.got-close');
    const storageKey = 'mk_offer_dismissed_v1'; 

    const isDismissed = localStorage.getItem(storageKey) === 'true';

    if (!isDismissed) {
      // 1. Erscheinen (Fällt von oben rein)
      setTimeout(() => {
        toast.classList.add('is-visible');
        toast.setAttribute('aria-hidden', 'false');
        
        // 2. Kurz darauf: Einmal kurz wackeln
        setTimeout(() => {
          toast.classList.add('animate-attention');
        }, 800); // 800ms warten (bis das Reinfallen fertig ist)
      }, 1000); 
    }

    closeBtn.addEventListener('click', function() {
      toast.classList.remove('is-visible');
      toast.setAttribute('aria-hidden', 'true');
      localStorage.setItem(storageKey, 'true');
    });
  });
</script>